{% extends 'base.html' %}
{% load static %}
{% load django_bootstrap5 %}

{% block content %}
<div class="container py-5">

  <!-- 個人資訊卡 -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body text-center">
      <div class="mb-3">
        {% if user_extend.photo %}
          <img src="{{ user_extend.photo.url }}" alt="{{ request.user.username }}" class="img-fluid rounded-circle" style="width:150px;height:150px;object-fit:cover;">
        {% else %}
          <img src="{% static 'default.jpg' %}" alt="Default" class="img-fluid rounded-circle" style="width:150px;height:150px;object-fit:cover;">
        {% endif %}
      </div>

      <h4 class="fw-bold mb-1">{{ request.user.username }}</h4>
      <div class="text-muted mb-2">{{ request.user.email }}</div>
      <div class="text-muted mb-3">加入日期：{{ request.user.date_joined|date:"Y-m-d" }}</div>

      {% if user_extend.is_brand or user_extend.is_club %}
        <div class="mb-3">
          <strong>身份：</strong>
          {% if user_extend.is_brand %}
            <span class="badge bg-primary">品牌方</span>
          {% elif user_extend.is_club %}
            <span class="badge bg-success">社團方</span>
          {% endif %}
        </div>
      {% endif %}

      {% if user_extend.description %}
        <p class="mb-3">{{ user_extend.description }}</p>
      {% endif %}

      <a href="{% url 'edit_profile' %}" class="btn btn-outline-primary rounded-pill px-4">編輯個人資料</a>
    </div>
  </div>

  <!-- 收藏（固定顯示） -->
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-light"><strong>我的收藏活動</strong></div>
        <div class="card-body">
          {% if favorite_activities %}
            <ul class="list-group list-group-flush">
              {% for a in favorite_activities %}
                <li class="list-group-item">
                  <a class="text-decoration-none" href="{% url 'activity_detail' a.id %}">{{ a.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">你還沒有收藏任何活動。</p>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-light"><strong>我的收藏贊助</strong></div>
        <div class="card-body">
          {% if favorite_sponsorships %}
            <ul class="list-group list-group-flush">
              {% for s in favorite_sponsorships %}
                <li class="list-group-item">
                  <a class="text-decoration-none" href="{% url 'sponsor_detail' s.id %}">{{ s.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">你還沒有收藏任何贊助。</p>
          {% endif %}
        </div>
      </div>
    </div>

    {% if user_extend.is_club %}
    <!-- 只有社團方 -->
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-light"><strong>我發布的活動</strong></div>
        <div class="card-body">
          {% if user_activities %}
            <ul class="list-group list-group-flush">
              {% for a in user_activities %}
                <li class="list-group-item">
                  <a class="text-decoration-none" href="{% url 'activity_detail' a.id %}">{{ a.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">你還沒有發布任何活動。</p>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    {% if user_extend.is_brand %}
    <!-- 只有品牌方 -->
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-light"><strong>我發布的贊助</strong></div>
        <div class="card-body">
          {% if user_sponsorships %}
            <ul class="list-group list-group-flush">
              {% for s in user_sponsorships %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <a class="text-decoration-none" href="{% url 'sponsor_detail' s.id %}">{{ s.title }}</a>
                  {% if not s.check_status %}
                    <span class="badge bg-warning text-dark">審核中</span>
                  {% elif s.check_status and s.is_active %}
                    <span class="badge bg-success">已上架</span>
                  {% else %}
                    <span class="badge bg-secondary">已下架</span>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">你還沒有發布任何贊助。</p>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<style>
  .card-header { font-weight: 700; }
  @media (max-width: 992px){
    .card-header, .card-body { text-align:center; }
  }
</style>
{% endblock %}
